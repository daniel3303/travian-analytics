function CreateActiveAction(n){var t=[];n===undefined||n===null||n.length<=0?$("body").find("a[data-model].activable").each(function(){t.push($(this))}):t.push(n);for(let n=0;n<t.length;n++){const i=t[n];i.on("click",function(n){n.preventDefault();const t=$(this),i=t.attr("data-model"),r=t.attr("data-key");i!==undefined&&r!==undefined&&$.post("/api/activable/index",{modelName:i,key:r},function(n){n===!0?(showMessage("Registo ativado com sucesso.",1),t.removeClass("deactivated").addClass("activated").find(".fa-toggle-on").removeClass("fa-rotate-180")):n===!1?(showMessage("Registo inativado com sucesso.",1),t.removeClass("activated").addClass("deactivated").find(".fa-toggle-on").removeClass("fa-rotate-180").addClass("fa-rotate-180")):location.href=location.href})})}}function Confirm(n,t){(n===undefined||n===null||n==="")&&(n="Deseja continuar?");$("body").find("#modalConfirm").find(".modal-text").text(n);$("body").find("#modalConfirm").modal({backdrop:"static"});$(document).unbind("keyup").keyup(function(n){const t=n.which;t===13||t===32?($("body").find("#modalConfirm").find(".btn-primary").trigger("click"),$(document).unbind("keyup")):t===27&&($("body").find("#modalConfirm").find(".btn-outline-primary").trigger("click"),$(document).unbind("keyup"))});$("body").find("#modalConfirm").find(".btn-primary").unbind("click").on("click",t).on("click",function(){$("body").find("#modalConfirm").modal("hide")}).trigger("focus")}function CreateCustomFileInput(){bsCustomFileInput.destroy();bsCustomFileInput.init()}function dynamicModal(n,t,i,r,u){(r===undefined||r===null||r==="")&&(r="Sim");(u===undefined||u===null||u==="")&&(u="Não");$("body").find("#modalDynamic").find(".modal-html").html(n);$("body").find("#modalDynamic").modal({backdrop:"static"});$("body").find("#modalDynamic").find(".btn-primary").text(r).unbind("click").on("click",t).on("click",function(){$("body").find("#modalDynamic").modal("hide")});$("body").find("#modalDynamic").find(".btn-outline-primary").text(u).unbind("click").on("click",i).on("click",function(){$("body").find("#modalDynamic").modal("hide")})}function CreateGallery(n){var t=[];n===undefined||n===null||n.length<=0?$("body").find(".gallery").each(function(){t.push($(this))}):t.push(n);for(let n=0;n<t.length;n++){const i=t[n];sortable(i.find(".galleryImages"),{forcePlaceholderSize:!0,placeholder:'<div class="col-12 col-sm-4 col-md-3 col-xl-2 mb-3 mb-3"><div class="w-100 h-100 bg-grey"><\/div><\/div>',itemSerializer:n=>$(n.node).data("id")})[0].addEventListener("sortupdate",function(n){const t=sortable($(n.target),"serialize")[0].items;$.ajax({url:"/admin/api/sortable",method:"POST",data:{dbset:"Images",items:t}}).fail(function(n){console.log(n)})});i.find("button.galleryDeleteButton").each(function(n){$(n).unbind("click")});i.find("button.galleryEditButton").each(function(n){$(n).unbind("click")});i.find("input.galleryUploadInput").on("change",function(n){if(this.files!==undefined&&this.files!==null){const t=[],i=this.files,r=this.files.length;for(let n=0;n<r;n++)t.push(i[n]);GalleryUploadFiles($(n.target).parent(),t);$(n.target).val("")}});i.find("button.galleryUploadButton").on("click",function(n){return n.preventDefault(),$(n.target).siblings("input.galleryUploadInput").trigger("click"),!1});i.on("click","button.galleryDeleteButton",function(n){n.stopPropagation();n.preventDefault();const t=$(n.target).parentsUntil(".galleryImageContainer").parent(),i=t.data("id");return Confirm("Deseja apagar a imagem?",function(){$.ajax({method:"POST",url:"/admin/api/images/gallerydelete",data:{imageid:i}}).done(function(){t.remove();showMessage("Imagem apagada com sucesso.",1)}).fail(function(){t.remove();showMessage("Não foi possível apagar a imagem!",-1)})}),!1});i.on("click","button.galleryEditButton",function(n){n.stopPropagation();n.preventDefault();const i=$(n.target).parentsUntil(".galleryImageContainer").parent(),t=i.data("id");return $.ajax({method:"GET",url:`/admin/api/images/galleryedit/${t}`}).done(function(n){dynamicModal(n,function(){const n=$("body").find("#GalleryEdit").serializeArray();n.push({name:"id",value:t});$.ajax({method:"POST",contentType:"application/x-www-form-urlencoded",url:"/admin/api/images/galleryedit",data:n}).done(function(){showMessage("Dados de imagem atualizados com sucesso",1)}).fail(function(){showMessage("Não foi possível atualizar os dados da imagem",-1)})},undefined,"Gravar","Cancelar");CreateLocalizableInputTab()}),!1})}}function GalleryUploadFiles(n,t){const i=n.data("gallery"),r=n.find(".progress-template").clone().html();for(let u=0;u<t.length;u++){const s=t[u],e=new FormData;e.append("galleryId",i);e.append("image",s);const f=new XMLHttpRequest;f.upload.index=u;const o=$(r);$(o).insertAfter(n.find(".galleryUploadInput"));f.upload.progressBar=o;f.upload.gallery=n;f.upload.addEventListener("progress",progressHandler,!1);f.addEventListener("load",completeHandler,!1);f.addEventListener("error",errorHandler);f.open("POST","/admin/api/images/galleryupload");f.send(e)}return!1}function progressHandler(n){const i=$(n.currentTarget.progressBar).find(".progress-bar");var t=n.loaded/n.total*100;t>=100&&(t=99);const r=Math.round(t)+"%";i.text(r);i.css("width",t*100)}function completeHandler(n){const t=n.currentTarget.upload.progressBar,i=n.currentTarget.upload.gallery,r=n.currentTarget.status;if(r>=400)errorHandler(n);else{const r=n.currentTarget.response;i.find(".galleryImages").prepend(r);t.remove()}}function errorHandler(n){showMessage("Não foi possível inserir a imagem",-1);$(n.currentTarget.upload.progressBar).remove()}function getScrollBarWidth(){const t=document.createElement("p");t.style.width="100%";t.style.height="200px";const n=document.createElement("div");n.style.position="absolute";n.style.top="0px";n.style.left="0px";n.style.visibility="hidden";n.style.width="200px";n.style.height="150px";n.style.overflow="hidden";n.appendChild(t);document.body.appendChild(n);const r=t.offsetWidth;n.style.overflow="scroll";var i=t.offsetWidth;return r==i&&(i=n.clientWidth),document.body.removeChild(n),r-i}function initLoader(){$("body").find(".loader").length||$("body").append('<div class="loader"><div class="message"><\/div><div class="icon"><i class="fas fa-spinner fa-pulse"><\/i><\/div><\/div>')}function showLoader(n){initLoader();(n===undefined||n==="")&&(n="Por favor aguarde...");$("body").find(".loader .message").html(n);$("body").find(".loader").show()}function hideLoader(){$("body").find(".loader .message").html("");$("body").find(".loader").hide()}function initMessages(){$("body").find(".alert-messages").length||$("body").append('<div class="alert-messages"><\/div>')}function showMessage(n,t){initMessages();var i="info",r="info";t==1||t=="Success"?(i="success",r="check"):t==-1||t=="Danger"?(i="danger",r="exclamation"):(t==-2||t=="Warning")&&(i="warning",r="exclamation");const o=document.createElement("span"),f=$(o);f.text(n);f.prepend(`<i class="text-${i} fas fa-${r} mr-2"></i>`);const s=document.createElement("DIV"),u=$(s);u.addClass("row m-0").on("click",function(){hideMessage($(this))});const h=document.createElement("DIV"),e=$(h);e.addClass(`bg-white cursor-pointer border-${i} border rounded p-2 mb-2`).attr("role","alert").append(f);u.append(e);$(".alert-messages").append(u);setTimeout(hideMessage,5e3,u)}function hideMessage(n){n.addClass("hidding");n.on("animationend",removeMessage);n.on("webkitAnimationEnd",removeMessage);n.on("mozAnimationEnd",removeMessage);setTimeout(removeMessage,300,n)}function removeMessage(n){$(n).length&&$(n).remove()}function CreateMVCGrid(n){var t=[];n===undefined||n===null||n.length<=0?$("body").find(".mvc-grid").each(function(){t.push(this)}):t.push(n);for(let n=0;n<t.length;n++)new MvcGrid(t[0])}function CreateRepo(n){var t=[];n===undefined||n===null||n.length<=0?$("body").find(".repo").each(function(){t.push($(this))}):t.push(n);for(let n=0;n<t.length;n++){const i=t[n];sortable(i.find(".repoFiles"),{handle:".sort-handle",forcePlaceholderSize:!0,placeholder:'<div class="col-12 mb-3"><div class="w-100 h-100 bg-grey"><\/div><\/div>',itemSerializer:n=>$(n.node).data("id")})[0].addEventListener("sortupdate",function(n){const t=sortable($(n.target),"serialize")[0].items,i=$(n.target).find(".sort-handle").data("model");$.ajax({url:"/api/sortable",method:"POST",data:{modelName:i,items:t}}).fail(function(n){console.log(n)})});i.find("button.repoDeleteButton").each(function(n){$(n).unbind("click")});i.find("button.repoEditButton").each(function(n){$(n).unbind("click")});i.find("input.repoUploadInput").on("change",function(n){if(this.files!==undefined&&this.files!==null){const t=[],i=this.files,r=this.files.length;for(let n=0;n<r;n++)t.push(i[n]);RepoUploadFiles($(n.target).parent(),t);$(n.target).val("")}});i.find("button.repoUploadButton").on("click",function(n){return n.preventDefault(),$(n.target).siblings("input.repoUploadInput").trigger("click"),!1});i.on("click","button.repoDeleteButton",function(n){n.stopPropagation();n.preventDefault();const t=$(n.target).parentsUntil(".repoFileContainer").parent(),i=t.data("id");return Confirm("Deseja apagar o ficheiro?",function(){$.ajax({method:"POST",url:"/api/files/filedelete",data:{fileid:i}}).done(function(){t.remove();showMessage("Ficheiro eliminado com sucesso.",1)}).fail(function(){t.remove();showMessage("Não foi possível apagar o ficheiro.",-1)})}),!1})}}function RepoUploadFiles(n,t){const i=n.data("repo"),r=n.find(".progress-template").clone().html();for(let u=0;u<t.length;u++){const s=t[u],e=new FormData;e.append("repoId",i);e.append("file",s);const f=new XMLHttpRequest;f.upload.index=u;const o=$(r);$(o).insertAfter(n.find(".repoUploadInput"));f.upload.progressBar=o;f.upload.repo=n;f.upload.addEventListener("progress",progressHandler,!1);f.addEventListener("load",completeHandler,!1);f.addEventListener("error",errorHandler);f.open("POST","/api/files/fileupload");f.send(e)}return!1}function progressHandler(n){const i=$(n.currentTarget.progressBar).find(".progress-bar");var t=n.loaded/n.total*100;t>=100&&(t=99);const r=Math.round(t)+"%";i.text(r);i.css("width",t*100)}function completeHandler(n){const t=n.currentTarget.upload.progressBar,i=n.currentTarget.upload.repo,r=n.currentTarget.status;if(r>=400)errorHandler(n);else{const r=n.currentTarget.response;i.find(".repoFiles").prepend(r);t.remove()}}function errorHandler(n){var t="Não foi possível inserir o ficheiro.";n.currentTarget.status==400&&(t=n.currentTarget.response);showMessage(t,-1);$(n.currentTarget.upload.progressBar).remove()}function CreateSelect2(n){(n===undefined||n===null)&&(n=$("form"));n.find("select.select2-element").length&&n.find("select.select2-element").each(function(){var t={language:"pt",placeholder:"",width:"resolve",allowClear:!0,matcher:matchAllWords,dropdownParent:null},n=$(this);t.dropdownParent=n.parent();n.data("search")==!1&&(t.minimumResultsForSearch=-1);n.data("clear")==!1&&(t.allowClear=!1);n.data("placeholder")!=undefined&&n.data("placeholder")!=""&&(t.placeholder=n.data("placeholder"));n.select2(t).on("select2:open",function(n){$(n.target).siblings(".select2-container").find(".select2-search__field").addClass("form-control");$(n.target).data("search")==!1&&$(n.target).siblings(".select2-container").find(".select2-search").remove()}).on("select2:select",function(n){$(this).closest("form").validate().element(n.target)});n.siblings(".select2").addClass("form-control")})}function slugify(n){return removeAccents(n.toString().toLowerCase()).replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function CreateSortableTable(n){var t=[];n===undefined||n===null||n.length<=0?$("body").find(".table").each(function(){$(this).find(".sort-handle").length&&t.push($(this))}):t.push(n);for(let n=0;n<t.length;n++){const i=t[n];if(i.find("tbody tr").length>1)sortable(i.find("tbody"),{handle:".sort-handle",itemSerializer:n=>$(n.node).find(".sort-handle").data("key")})[0].addEventListener("sortupdate",function(n){const t=sortable($(n.target),"serialize")[0].items,i=$(n.target).find(".sort-handle").data("model");$.ajax({url:"/api/sortable",method:"POST",data:{modelName:i,items:t}}).fail(function(n,t){console.log(t)})});else{let n=undefined;n=i.find(".sort-handle").parentsUntil("td").length===0?i.find(".sort-handle").parent("td"):i.find(".sort-handle").parentsUntil("td").parent();const t=n.index();i.find("td:nth-child("+(t+1)+"), th:nth-child("+(t+1)+")").hide()}}}function removeAccents(n){n=n.split("");const r=n.length;for(var i,t=0;t<r;t++)(i="ÀÁÂÃÄÅàáâãäåÒÓÔÕÕÖØòóôõöøÈÉÊËèéêëðÇçÐÌÍÎÏìíîïÙÚÛÜùúûüÑñŠšŸÿýŽž".indexOf(n[t]))!==-1&&(n[t]="AAAAAAaaaaaaOOOOOOOooooooEEEEeeeeeCcDIIIIiiiiUUUUuuuuNnSsYyyZz"[i]);return n.join("")}function matchAllWords(n,t){if($.trim(n.term)==="")return t;if(typeof t.text=="undefined")return null;const i=n.term.split(" ");for(j=0;j<i.length;j++)i[j]=removeAccents(i[j]).trim();var r=!0;for(let n=0;n<i.length;n++){const u=i[n];u!==""&&removeAccents(t.text.toUpperCase()).indexOf(u.toUpperCase())<0&&(r=!1)}return r?$.extend({},t,!0):null}function pad(n,t,i){return n=n.toString(),n.length<t?pad(`${i}${n}`,t):n}function formatDate(n){return pad(n.getDate(),2,"0")+"/"+pad(n.getMonth()+1,2,"0")+"/"+n.getFullYear()}function formatCurrency(n){return n.toFixed(2).replace(",",".")+"€"}$(document).ready(function(){CreateActiveAction()});$(document).ready(function(){$(".checkbox-all").on("change",function(){var n=$(this).data("checkbox"),t=$(this).prop("checked");n!=undefined&&n!=""&&$(`input.checkbox-all-target[data-checkbox="${n}"]`).each(function(){$(this).prop("checked",t).trigger("change")})});$("input.checkbox-all-target").on("change",function(){var n=$(this).data("checkbox"),t;n!=undefined&&n!=""&&(t=!0,$(`input.checkbox-all-target[data-checkbox="${n}"]`).each(function(){if(!$(this).prop("checked"))return t=!1,!1}),$(`.checkbox-all[data-checkbox="${n}"]`).prop("checked",t))});$(".checkbox-all").each(function(){var n=$(this).data("checkbox"),t;n!=undefined&&n!=""&&(t=!0,$(`input.checkbox-all-target[data-checkbox="${n}"]`).each(function(){if(!$(this).prop("checked"))return t=!1,!1}),$(`.checkbox-all[data-checkbox="${n}"]`).prop("checked",t))})});$(document).ready(function(){$(".clear-input").on("click",function(){$(this).siblings("input").val("")});$(".clear-select").on("click",function(){$(this).parent().find("select").val("").trigger("change")})});$(document).ready(function(){const n=$("[type=color]");n.length>0&&n.each(function(n,t){const i=$(t);i.hide();i.after('<div class="color-picker"><\/div>');i.attr("type","hidden");Pickr.create({el:i.next(".color-picker").get(0),theme:"nano","default":i.val(),components:{preview:!0,opacity:!0,hue:!0,interaction:{hex:!1,input:!0,clear:!1,save:!0}},i18n:{"btn:save":"Guardar","btn:cancel":"Cancelar","btn:clear":"Apagar"}}).on("change",n=>{i.val(n.toHEXA().toString())}).on("save",(n,t)=>{t.hide()})})});$(document).ready(function(){$(".form-confirm").on("submit",function(n){if($(this).hasClass("form-confirm")){n.preventDefault();n.stopPropagation();const t=$(this);return Confirm(t.data("message"),function(){t.removeClass("form-confirm");t.submit()}),!1}});$(".btn-confirm").on("submit",function(n){if($(this).hasClass("btn-confirm")){n.preventDefault();n.stopPropagation();const t=$(this);return Confirm(t.data("message"),function(){t.removeClass("btn-confirm");t.trigger("click")}),!1}})});$(document).ready(function(){CreateCustomFileInput()});$(document).ready(function(){const n={language:"pt",templates:{leftArrow:'<i class="fas fa-chevron-left"><\/i>',rightArrow:'<i class="fas fa-chevron-right"><\/i>'},format:"dd/mm/yyyy",startView:0,startDate:"-99y",endDate:"+99y",clearBtn:!0,autoclose:!0};$(".datepicker-div").each(function(){const t=$(this);t.data("start")!==undefined&&(n.startDate=t.data("start"));t.data("end")!==undefined&&(n.endDate=t.data("end"));t.data("view")!==undefined&&(n.startView=t.data("view"));t.datepicker(n).on("changeDate",function(n){$(n.target).trigger("blur")})})});$(document).ready(function(){$(".file-input-delete").on("click",function(){$(this).siblings("input").val(!0);$(this).siblings(".open-file").remove();$(this).parent().siblings(".custom-file").removeClass("d-none");$(this).remove()})});$(document).ready(function(){CreateGallery()});MvcGrid.lang={"default":{equals:"Igual","not-equals":"Diferente"},text:{contains:"Contêm",equals:"Igual","not-equals":"Diferente","starts-with":"Começa com","ends-with":"Termina com"},number:{equals:"Igual","not-equals":"Diferente","less-than":"Menor que","greater-than":"Maior que","less-than-or-equal":"Menor ou igual a","greater-than-or-equal":"Maior ou igual a"},date:{equals:"Igual","not-equals":"Diferente","earlier-than":"Antes de","later-than":"Depois de","earlier-than-or-equal":"Antes ou igual a","later-than-or-equal":"Depois ou igual a"},guid:{equals:"Igual","not-equals":"Diferente"},filter:{apply:"✓",remove:"✘"},operator:{select:"",and:"e",or:"ou"}};$(document).ready(function(){$(".image-input-delete").on("click",function(){$(this).siblings("input").val(!0);$(this).siblings("img").remove();$(this).parent().siblings(".custom-file").removeClass("d-none");$(this).remove()})});$.validator.setDefaults({ignore:""});$.validator.methods.number=function(n,t){return this.optional(t)||/^-?(?:\d+|\d{1,3}(?:\.\d{3})+)?(?:,\d+)?$/.test(n)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(n)};jQuery.validator.addMethod("minimumelements",function(n){return n!=null&&n!=undefined?$.isArray(n)?n.length>0:n!="":!1});jQuery.validator.unobtrusive.adapters.addBool("minimumelements");jQuery.extend(jQuery.validator.messages,{required:"Campo obrigatório.",remote:"Corrija este campo.",email:"Introduza um endereço de e-mail válido.",url:"Introduza um URL válido.",date:"Introduza uma data válida.",dateISO:"Introduza uma data válida.",number:"Introduza um número válido.",digits:"Introduza apenas dígitos.",creditcard:"Introduza um número de cartão de crédito válido.",equalTo:"Introduza o mesmo valor.",maxlength:jQuery.validator.format("Não introduza mais do que {0} caracteres."),minlength:jQuery.validator.format("Introduza pelo menos {0} caracteres."),rangelength:jQuery.validator.format("Introduza um valor entre {0} e {1} caracteres."),range:jQuery.validator.format("Introduza um valor entre {0} e {1}."),max:jQuery.validator.format("Introduza um valor inferior ou igual a {0}."),min:jQuery.validator.format("Introduza um valor superior ou igual a {0}.")});$(document).ready(function(){const n=getScrollBarWidth();$(".sidebar-container").css("padding-right",n+"px");$(".sidebar").css("right",-n+"px");$(".sidebar-toggle").on("click",function(){$("body").toggleClass("sidebar-toggle")});$(".sidebar-overlay").on("click",function(){$("body").toggleClass("sidebar-toggle")})});$(document).ready(function(){initLoader()});$(document).ready(function(){initMessages()});$(document).ready(function(){CreateMVCGrid()});$(document).ready(function(){CreateRepo()});$(document).ready(function(){CreateSelect2()});$(document).ready(function(){$(".slugify-btn").on("click",function(){const n=$(this).siblings("input"),t=$(`#${$(this).data("source").replace("[","\\[").replace("]","\\]")}`);n.val(slugify(t.val()))});$(".slugify-source").on("blur",function(){const t=$(this),n=$(`#${$(this).data("target").replace("[","\\[").replace("]","\\]")}`);n.val()===""&&n.val(slugify(t.val()))})});$(document).ready(function(){CreateSortableTable()});